#!/usr/bin/env node

require('../src/build'); // Returns global z
var program = require('commander');
var fs = require('fs');

program
  .version('0.0.1')
  .usage('[options] [commands]');

program
  .command('build [src] [dest]')
  .description('build a z app into a single file')
  .description('Compile a z app into a single file')
  .option('-o --optimize', 'uglify the compiled script')
  .option('-f --full', 'compile with the full z library')
  .option('-p --project <projectName>', 'set the project name')
  .option('-m --main <mainModule>', "set the name of your main module (if using an anonymous module)")
  .action(function(src, dest, options){

    options = options || {};

    if(typeof src === "undefined"){
      // Look for a build.json file
      var buildfile = require(process.cwd() + "/build.json");
      for (key in buildfile) {
        if (buildfile.hasOwnProperty(key)) {
          options[key] = buildfile[key];
        }
      }
    }

    options.main = src;
    options.dest = dest;

    // Compile away!
    z.build.newInstance(options);

  })
  .on('--help', function(){
    console.log('   Examples:\n');
    console.log('   $ zjs build -o foo/scripts/main.js foo/scripts/app-min.js\n');
  });

program.parse(process.argv);
if (!program.args.length) program.help();