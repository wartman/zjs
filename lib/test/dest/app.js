/*test.src.main*/
!function(){!function(t,e){"object"==typeof module&&"object"==typeof module.exports&&(t=module.exports),e(t)}("undefined"!=typeof window?window:this,function(t){var e,n=Array.prototype.forEach,i=Array.prototype.slice,r=Object.prototype.toString,o=Object.keys,s={};s.each=function(t,e,i){if(!t)return t;if(i=i||t,n&&t.forEach)t.forEach(e);else if(s.isArray(t))for(var r=0;r<t.length&&(!t[r]||!e.call(i,t[r],r,t));r+=1);else for(var o in t)if(t.hasOwnProperty(o)&&o&&e.call(i,t[o],o,t))break;return t},s.eachReverse=function(t,e,n){if(t){var i;for(i=t.length-1;i>-1&&(!t[i]||!e.call(n,t[i],i,t));i-=1);}return t},s.extend=function(t){return s.each(i.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},s.isObject=function(t){return t===Object(t)},s.defaults=function(t,e){if(void 0===e)return t;for(var n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n]);return e},s.keys=function(t){if(!s.isObject(t))return[];if(o)return o(t);var e=[];for(var n in t)e.push(n);return e},s.isEmpty=function(t){if(null==t)return!0;if(t instanceof Array||t instanceof String)return 0===t.length;for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};var a={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},u=/\\|'|\r|\n|\t|\u2028|\u2029/g;s.escape=function(t){return t.replace(u,function(t){return"\\"+a[t]})},s.each(["Arguments","Function","String","Number","Date","RegExp"],function(t){s["is"+t]=function(e){return r.call(e)=="[object "+t+"]"}}),s.isArray=Array.isArray||function(t){return"[object Array]"==r.call(t)},s.async=function(){var e=[],n=function(t){return 1===e.push(t)},i=function(){var t=e,n=0,i=e.length;for(e=[];i>n;)try{t[n++]()}catch(r){s.async(function(){throw r})}};if("undefined"!=typeof setImmediate&&s.isFunction(setImmediate))return function(t){n(t)&&setImmediate(i)};if("object"==typeof process&&process.nextTick)return function(t){n(t)&&process.nextTick(i)};if(t.postMessage){var r=!0;if(t.attachEvent){var o=function(){r=!1};t.attachEvent("onmessage",o),t.postMessage("__checkAsync","*"),t.detachEvent("onmessage",o)}if(r){var a="__promise"+new Date,u=function(t){t.data===a&&(t.stopPropagation&&t.stopPropagation(),i())};return t.addEventListener?t.addEventListener("message",u,!0):t.attachEvent("onmessage",u),function(e){n(e)&&t.postMessage(a,"*")}}}return function(t){n(t)&&setTimeout(i,0)}}();var c=t.z=function(t,n){if(s.isFunction(t)&&(n=t,t=e),c.has(t)&&!n)return c.modules[t];var i=h(t);return s.isFunction(n)&&2===n.length?l(i,n):n&&i.exports(n),i},f=t.module;t.module=c,c.noConflict=function(){t.module=f};var h=function(t){if("undefined"==typeof t){var e;if(!g)return p=new L;e=E||b.getInteractiveScript(),t=e.getAttribute("data-from")}return c.modules[t]=new L,c.modules[t]},l=function(t,e){var n=function(){return L.prototype.imports.apply(t,arguments)},i=function(){return L.prototype.exports.apply(t,arguments)};e.call(t,n,i)},p=null;c.modules={},c.has=function(t){return c.modules.hasOwnProperty(t)},c.ensureModule=function(t){var e=p;null!==e&&(p=null,!e instanceof L||(c.modules[t]=e))},c.config={root:"",shim:{},alias:{},env:"browser",auto:!0},c.setup=function(t){c.config=s.defaults(c.config,t)};var d=/xyz/.test(function(){})?/\b__super__\b/:/[\D|\d]*/,_=function(t){var e=this.prototype,n=this,i=s.isFunction(t.__new__)?function(){var e=t.__new__;return delete t.__new__,e}():function(){n.apply(this,arguments)},r=function(){this.constructor=i};r.prototype=this.prototype,i.prototype=new r;for(var o in t)i.prototype[o]=s.isFunction(t[o])&&s.isFunction(e[o])&&d.test(t[o])?function(t,n){return function(){var i=this.__super__;this.__super__=e[t];var r=n.apply(this,arguments);return this.__super__=i,r}}(o,t[o]):t[o];return i.prototype.constructor=i,i.extend=arguments.callee,i},y=function(){this.__init__&&this.__init__.apply(this,arguments)};c.Class=function(t,e){if(e||(e=t,t=!1),!t)return _.call(y,e);if(t&&hasOwnProperty.call(t,"extend"))return t.extend(e);if(s.isFunction(t))return _.call(t,e);if(s.isObject(t))return t.__new__=y,_.call(t,e);throw new TypeError("{parent} must be a function, object or undefined.")};var m={PENDING:0,READY:1,REJECTED:-1},v=c.Resolver=c.Class({__new__:function(){this._onReady=[],this._onRejected=[],this._value=null,this._state=m.PENDING,this.__init__&&this.__init__.apply(this,arguments)},done:function(t,e){return t&&(this.isReady()?t(this._value):this._onReady.push(t)),e&&(this.isRejected()?e(this._value):this._onRejected.push(e)),this},failed:function(t){return this.ready(void 0,t)},then:function(t){return this.ready(t,onFailed)},resolve:function(t){this._value=t,this._state=m.READY,this._dispatch(this._onReady)},reject:function(t){this._value=t,this._state=m.REJECTED,this._dispatch(this._onRejected)},_dispatch:function(t){for(var e=this._value,n=this;t.length;){var i=t.shift();i.call(n,e)}}});s.each(["Ready","Rejected","Pending"],function(t){var e=t.toUpperCase();v.prototype["is"+t]=function(){return this._state===m[e]}});var b=c.Script=v.extend({options:{nodeType:"text/javascript",charset:"utf-8",async:!0},__init__:function(t,e){this.options=s.defaults(this.options,e),this.node=!1,this.load(t)},create:function(){var t=document.createElement("script");return t.type=this.options.nodeType||"text/javascript",t.charset=this.options.charset,t.async=this.options.async,t},load:function(t){var e=this.create(),n=document.getElementsByTagName("head")[0],i=this,r=(this.scriptSettings,{src:""});s.isString(t)&&(t={src:t}),t=s.defaults(r,t),e.setAttribute("data-from",t.from||t.src),w(e,function(t){i.resolve(t)},function(t){i.reject(t)}),E=e,e.src=t.src,n.appendChild(e),E=null}}),g=!1,E=null,x=null;b.getInteractiveScript=function(){return x&&"interactive"===x.readyState?x:(s.eachReverse(b.scripts(),function(t){return"interactive"===t.readyState?(x=t,!0):void 0}),x)},b.scripts=function(){return document.getElementsByTagName("script")};var w=function(){if("undefined"==typeof document)return function(){};var t=document.createElement("script"),e=null;return e=t.attachEvent?function(t,e){g=!0,t.attachEvent("onreadystatechange",function(){"complete"===t.readyState&&(e(t),x=null)})}:function(t,e,n){t.addEventListener("load",function(){e(t)},!1),t.addEventListener("error",function(t){n(t)},!1)}}();c.script=function(t,e,n){var i=new b(t,c.config.script);return i.done(e,n),i};var j={PENDING:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4,FAILED:-1},A=["GET","PUT","POST","DELETE"],O=c.Ajax=v.extend({options:{defaults:{src:"",method:"GET",data:!1}},__init__:function(t,e){this.options=s.defaults(this.options,e),this.load(t)},load:function(t){var e,n=this,i="GET";if(t=s.defaults(this.options.defaults,t),i="GET"===t.method.toUpperCase(),A.indexOf(i)<=0&&(i="GET"),e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e.onreadystatechange=function(){j.DONE===this.readyState&&(200===this.status?n.resolve(this.responseText):n.reject(this.status))},"GET"===i&&t.data&&(t.src+="?"+this._buildQueryStr(t.data)),e.open(i,t.src,!0),"POST"===i&&t.data){var r=this._buildQueryStr(t.data);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(r)}else e.send()},_buildQueryStr:function(t){var e=[];for(var n in t)e.push(n+"="+t[n]);return e.join("&")}});s.each(["Done","Pending","Failed"],function(t){O.prototype["is"+t]=function(){return this._state===j[t.toUpperCase()]}}),c.ajax=function(t,e,n){var i=new O(t,c.config.ajax);return i.done(e,n),i};var F={_scopes:{all:{}},add:function(t,e,n){this._scopes.hasOwnProperty(t)||(this._scopes[t]={});var i=function(t){var i=c.config[e]||{};return n(t,i,s)};this._scopes[t][e]=i},dispatch:function(t,e){if(!this._scopes.hasOwnProperty(t))throw new Error("No filters in the requested scope: "+t);if(!e||!s.isObject(e))throw new TypeError("Request must be an object: "+typeof e);var n=this._scopes[t];return s.each(n,function(t,n){try{e=t(e)}catch(i){throw new Error("Filter `"+n+"` failed with error: "+i.message)}}),e}};c.filter=function(t,e,n){return arguments.length<=1&&F._scopes.hasOwnProperty(t)?F._scopes[t]:(F.add(t,e,n),F._scopes[t])},c.runFilters=function(t,e){return F.dispatch(t,e)};var P=/([\S^\!]+?)\!/g,R=/\.([txt|json]+?)$/g,T={ajax:["ajax","json","txt"]};c.filter("all","plugin",function(t){return P.test(t.from)?(t.from.replace(P,function(e,n){if(T.ajax.indexOf(n)>=0)t.options.type="ajax",t.options.ext=t.options.ext||("ajax"===n?"json":n);else{var i=c.loader(n);i&&(t.options.type=i.options.type||n,t.options.ext=t.options.ext||i.options.ext)}t.fromAlias=t.fromAlias?t.fromAlias.replace(e,""):t.from.replace(e,"")}),R.test(t.from)&&t.from.replace(R,function(e,n){t.options.ext=n,t.fromAlias=t.fromAlias.replace(e,"")}),t):t}),c.filter("all","alias",function(t,e){var n=new RegExp("["+t.from.replace(/\./g,"\\.")+"]+?"),i=!1,r="";for(var o in e)n.test(o)&&(i=o,r=e[o]);return i?(t.fromAlias=t.fromAlias?t.fromAlias.replace(i,r):t.from.replace(i,r),t):t}),c.filter("all","shim",function(t,e){if(!e.hasOwnProperty(t.from))return t;var n=t.options.ext||"js";return s.isFunction(e[t.from])?e[t.from](t):(t.src=c.config.root+e[t.from].src+"."+n,t)}),c.filter("all","src",function(t){if(t.src)return t;if(!t.options.ext){var e=c.loader(t.options.type||"script");t.options.ext=e.options.ext}var n=t.fromAlias||t.from,i=t.options.ext,r=n.replace(/\./g,"/");return r=c.config.root+r+"."+i,r=r.trim(),t.src=r,t}),c.filter("ajax","method",function(t){if(t.method)return t;if(t.options.method)return t.method=t.options.method,delete t.options.method,t;var e=c.loader(t.options.type||"ajax");return t.method=e.options.method.toLowerCase(),t});var D=function(t){this._queue={},t=t||{},this._filters=t.filters||!1,this.options=s.defaults(this.options,t.options),this._method=t.method||c.Script,this._handler=t.handler||function(t,e,n){n(e)},this._build=t.build||!1};D.prototype.options={ext:"js"},D.prototype.prefilter=function(t){return this._filters?(s.each(this._filters,function(e){t=c.runFilters(e,t)}),t):t},D.prototype.method=function(t){return this._method=t,this},D.prototype.filters=function(t){return t?s.isArray(t)?void this._filters.concat(t):(this._filters.push(t),this):void 0},D.prototype.handler=function(t){return t?(this._handler=t,this):this},D.prototype.build=function(t){return t?(this._build=t,this):this},D.prototype.has=function(t){return this._queue.hasOwnProperty(t)},D.prototype.load=function(t,e,n){var i=this;return t=this.prefilter(t),this.has(t.src)||(this._queue[t.src]=new this._method(t)),this._queue[t.src].done(function(r){i._handler(t,r,e,n),"browser"!==c.config.env&&i._build&&c.loader.build(t,r,i)},n),this};var S={};c.loader=function(t,e){return arguments.length<=1?S.hasOwnProperty(t)?S[t]:!1:(S[t]=new D(e),S[t])},c.loader.build=function(){};c.UseModule=c.Resolver.extend({load:function(t){if(console.log("loading"),c.has(t.from))this.resolve(t);else{var e=this;setTimeout(function(){e.resolve(t)},0)}}});c.loader("script",{method:c.UseModule,filters:["alias","shim","src"],handler:function(t,e,n){n()},options:{ext:"js"}}),c.loader("ajax",{method:c.UseModule,filters:["alias","shim","src","ajaxMethod"],handler:function(t,e,n){n()},options:{ext:"js",method:"GET"}});var N={PENDING:0,LOADED:1,ENABLED:2,FAILED:-1},L=function(){this._deps=[],this._state=N.PENDING,this._factory=null,this._definition=null,this._onReady=[],this._onFailed=[]},I=/\s?([\S]+?)\s?\@\s?([\S]+?)\s?$/;L.prototype.use=function(t){if(!this.isEnabled())return!1;var e=this,n=!1,i={};return t?(s.isArray(t)||(n=!0,t=[t]),s.each(t,function(t){var r=t,o=t;I.test(t)&&t.replace(I,function(t,e,n){return o=e,r=n,t}),e._definition.hasOwnProperty(o)&&(n?i=e._definition[o]:i[r]=e._definition[o])}),i):this._definition},L.prototype.imports=function(t,e,n){this._state=N.PENDING;var i=!1;if(I.test(t)){var r=t;r.replace(I,function(e,n,r){t=n.trim(),i=r.trim()})}e=e&&"*"!==e?s.isArray(e)?e:[e]:!1,n=s.defaults({type:"script"},n);var o={from:t,alias:i,uses:e,options:n};return this._deps.push(o),this},L.prototype.exports=function(t,e){var n=this;return arguments.length<=1&&(e=t,t=!1),t?(null===this._factory&&(this._factory={}),this._factory[t]=e):this._factory=e,s.async(function(){n.enable()}),this},L.prototype.enable=function(t,e){return this.done(t,e),this.isPending()?(G.call(this),this):this.isLoaded()?(M.call(this),this):this.isFailed()?(C.call(this,this._onFailed,this),this._onFailed=[],this):(this.isEnabled()&&(C.call(this,this._onReady,this),this._onReady=[]),this)},L.prototype.disable=function(){return this.isFailed(!0),this.enable()},L.prototype.done=function(t,e){var n=this;return s.async(function(){t&&s.isFunction(t)&&(n.isEnabled()?t.call(n):n._onReady.push(t)),e&&s.isFunction(e)&&(n.isFailed()?e.call(n):n._onFailed.push(e))}),this},L.prototype.fail=function(t){return this.done(e,t)},s.each(["Enabled","Loaded","Pending","Failed"],function(t){var e=N[t.toUpperCase()];L.prototype["is"+t]=function(t){return t&&(this._state=e),this._state===e}});var C=function(t,e){s.each(t,function(t){t.call(e)})},G=function(){var t=[],e=this;s.each(this._deps,function(e){!1===c.has(e.from)&&t.push(e)});var n=t.length;n>0?s.each(t,function(t){t=c.runFilters("all",t);var i=t.options.type||"script",r=c.loader(i);r.load(t,function(){n-=1,0>=n&&(e.isLoaded(!0),e.enable())},function(t){throw e.disable(),t})}):(this.isLoaded(!0),this.enable())},M=function(){var t={},e=this;if(s.each(this._deps,function(n){if(t){if(!c.has(n.from))throw new Error("A dependency is not in the registry: "+n.from);var i=c(n.from),r={};if(i.isFailed())throw e.disable(),new Error("A dependency failed: "+n.from);if(!i.isEnabled())return i.enable().done(function(){e.enable()}),t=!1,!0;n.uses?r=i.use(n.uses):n.alias?r[n.alias]=i._definition:r[n.from.split(".").pop()]=i._definition,t=s.extend(t,r)}}),t){try{"server"!==c.config.env?s.isFunction(this._factory)?this._definition=this._factory(t):s.isObject(this._factory)?(this._definition={},s.each(this._factory,function(n,i){e._definition[i]=s.isFunction(n)?n(t):n})):this._definition=this._factory:this._definition=!0}catch(n){throw this.disable(),n}this.isEnabled(!0),this.enable()}};t.define=function(e,n,i){2===arguments.length&&(i=n,n=e,e=void 0,s.isArray(n)||(e=n,n=[])),1===arguments.length&&(i=e,n=[],e=void 0);var r=c(e);s.each(n,function(t){r.imports(t.split("/").join("."))}),r.exports(function(e){var n=[];for(var r in e)n.push(e[r]);var o,a=t.exports,u=t.module;return t.exports={},t.module={},o=i.apply(this,n),!1===s.isEmpty(t.exports)&&(o=t.exports),t.module.exports&&(o=t.module.exports),t.exports=a,t.module=u,o})},t.define.amd={jQuery:!0}}),z.setup({root:"",shim:{"fud.foo":{src:"test/src/foo"}},alias:{fud:"test.src"}}),z("main").imports("fud.bar","*").exports(function(t){document.getElementById("done").innerHTML="result should be barfoo: "+t.bar.bar;var e=t.bar;return{fud:e}}),z("fud.bar").imports("fud.foo","foo").imports("fud.bin","bin").exports(function(t){var e="bar"+t.foo,n=("bin"+t.bin,z.Class({__init__:function(){this.foo="foo"}}));return{bar:e,testClass:n}}),z("fud.foo",function(){var t="foo";return{foo:t}});var t=z("fud.bin").imports("fud.foob","foob").imports("fud.txt.test","*",{type:"ajax",ext:"txt"});t.exports(function(t){var e="bin"+t.foob;return{bin:e}}),z("fud.foob",function(){var t="foob";return{foob:t}}),z("fud.txt.test").exports(function(){return"test"})}(window);